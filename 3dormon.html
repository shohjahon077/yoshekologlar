<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Yosh Ekologlar - 3D O'rmon Sayohati</title>
    <meta name="description" content="O'zingizni hududingizni yashillashtirishga undaydigan interaktiv 3D o'rmon sayti">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&family=Open+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
      /* ========================================
   GLOBAL STYLES
   ======================================== */
:root {
    --primary-green: #2ECC71;
    --primary-green-dark: #27AE60;
    --secondary-blue: #3498DB;
    --secondary-blue-dark: #2980B9;
    --accent-yellow: #F39C12;
    --accent-orange: #E67E22;
    --dark-charcoal: #2C3E50;
    --dark-slate: #1F2937;
    --light-gray: #ECF0F1;
    --light-silver: #F3F4F6;
    --text-dark: #111827;
    --text-light: #6B7280;
    --white: #FFFFFF;
    --transition-fast: all 0.3s ease;
    --transition-normal: all 0.5s ease;
    --transition-slow: all 0.8s ease;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
}

body {
    font-family: 'Open Sans', sans-serif;
    color: var(--text-dark);
    overflow: hidden;
    background: var(--dark-slate);
    touch-action: none;
}

h1, h2, h3, h4, h5, h6 {
    font-family: 'Montserrat', sans-serif;
    font-weight: 700;
}

/* Hide on mobile/desktop */
.mobile-only {
    display: none;
}

.desktop-only {
    display: block;
}

/* ========================================
   CANVAS
   ======================================== */
#canvas-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1;
}

#forest-canvas {
    width: 100%;
    height: 100%;
    display: block;
}

/* ========================================
   FOREST UI
   ======================================== */
.forest-ui {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 100;
    pointer-events: none;
}

/* ========================================
   SECTION INFO
   ======================================== */
.section-info {
    position: absolute;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(44, 62, 80, 0.92);
    backdrop-filter: blur(10px);
    border-radius: 16px;
    padding: 20px 30px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    pointer-events: all;
    border: 2px solid rgba(46, 204, 113, 0.3);
    max-width: 600px;
    animation: fadeInDown 0.5s ease-out;
}

@keyframes fadeInDown {
    from {
        opacity: 0;
        transform: translateX(-50%) translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
    }
}

.section-title {
    color: var(--white);
    font-size: 24px;
    margin-bottom: 8px;
    font-weight: 700;
}

.section-description {
    color: var(--light-gray);
    font-size: 15px;
    line-height: 1.5;
}

/* ========================================
   NAVIGATION BUTTONS (Desktop)
   ======================================== */
.nav-buttons {
    position: absolute;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 15px;
    background: rgba(44, 62, 80, 0.92);
    backdrop-filter: blur(10px);
    border-radius: 50px;
    padding: 10px 20px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    pointer-events: all;
    border: 2px solid rgba(46, 204, 113, 0.3);
}

.nav-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 12px 20px;
    background: rgba(255, 255, 255, 0.1);
    border: none;
    border-radius: 40px;
    color: var(--white);
    font-family: 'Montserrat', sans-serif;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition-fast);
    backdrop-filter: blur(5px);
}

.nav-btn:hover {
    background: rgba(46, 204, 113, 0.4);
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(46, 204, 113, 0.4);
}

.nav-btn:active {
    transform: translateY(0);
}

.nav-btn i {
    font-size: 18px;
}

/* ========================================
   MOBILE NAVIGATION
   ======================================== */
.mobile-nav {
    position: absolute;
    bottom: 20px;
    left: 0;
    width: 100%;
    pointer-events: all;
    z-index: 200;
}

.mobile-nav-toggle {
    width: 100%;
    padding: 16px 20px;
    background: linear-gradient(135deg, rgba(46, 204, 113, 0.9) 0%, rgba(46, 204, 113, 0.8) 100%);
    border: none;
    border-radius: 24px 24px 0 0;
    color: var(--white);
    font-family: 'Montserrat', sans-serif;
    font-size: 16px;
    font-weight: 700;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
    transition: var(--transition-fast);
}

.mobile-nav-toggle i {
    font-size: 20px;
}

.mobile-nav-toggle:active {
    transform: scale(0.98);
}

.mobile-nav-menu {
    background: rgba(44, 62, 80, 0.95);
    backdrop-filter: blur(10px);
    border-radius: 16px 16px 0 0;
    padding: 20px;
    box-shadow: 0 -4px 30px rgba(0, 0, 0, 0.4);
    transform: translateY(100%);
    transition: transform 0.4s ease;
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 15px;
    pointer-events: none;
    opacity: 0;
}

.mobile-nav-menu.active {
    transform: translateY(0);
    pointer-events: all;
    opacity: 1;
}

.mobile-nav-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    padding: 15px 5px;
    background: rgba(255, 255, 255, 0.1);
    border: none;
    border-radius: 16px;
    color: var(--white);
    font-family: 'Montserrat', sans-serif;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition-fast);
    text-align: center;
}

.mobile-nav-item:hover {
    background: rgba(46, 204, 113, 0.4);
    transform: translateY(-3px);
}

.mobile-nav-item:active {
    transform: scale(0.95);
}

.mobile-nav-item i {
    font-size: 24px;
}

/* ========================================
   MOBILE CONTROLS
   ======================================== */
.mobile-controls {
    position: absolute;
    bottom: 30px;
    left: 0;
    width: 100%;
    display: flex;
    justify-content: space-between;
    padding: 0 20px;
    pointer-events: none;
    z-index: 150;
}

/* Joystick */
.joystick-container {
    width: 100px;
    height: 100px;
    position: relative;
    pointer-events: all;
}

.joystick-base {
    position: absolute;
    width: 100%;
    height: 100%;
    background: rgba(46, 204, 113, 0.3);
    border-radius: 50%;
    border: 3px solid rgba(46, 204, 113, 0.6);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
}

.joystick-thumb {
    position: absolute;
    width: 40px;
    height: 40px;
    background: rgba(46, 204, 113, 0.8);
    border-radius: 50%;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.4);
    pointer-events: none;
}

/* Action Button - FIXED FOR MOBILE */
.action-button {
    width: 70px;
    height: 70px;
    background: linear-gradient(135deg, rgba(46, 204, 113, 0.95) 0%, rgba(46, 204, 113, 0.85) 100%);
    border: none;
    border-radius: 50%;
    color: var(--white);
    font-size: 28px;
    cursor: pointer;
    box-shadow: 0 6px 25px rgba(46, 204, 113, 0.5);
    pointer-events: all;
    transition: var(--transition-fast);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 160;
    flex-direction: column;
}

.action-button:active {
    transform: scale(0.9);
    box-shadow: 0 4px 15px rgba(46, 204, 113, 0.4);
}

.mobile-action-text {
    font-size: 8px;
    font-family: 'Montserrat', sans-serif;
    font-weight: 700;
    margin-top: -5px;
}

/* ========================================
   READ BUTTON (Desktop)
   ======================================== */
.read-button {
    position: absolute;
    bottom: 150px;
    right: 30px;
    padding: 16px 28px;
    background: linear-gradient(135deg, rgba(46, 204, 113, 0.95) 0%, rgba(46, 204, 113, 0.85) 100%);
    border: none;
    border-radius: 50px;
    color: var(--white);
    font-family: 'Montserrat', sans-serif;
    font-size: 16px;
    font-weight: 700;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 10px;
    box-shadow: 0 6px 25px rgba(46, 204, 113, 0.5);
    pointer-events: all;
    transition: var(--transition-fast);
    animation: pulse 2s infinite;
    z-index: 120;
}

@keyframes pulse {
    0%, 100% {
        box-shadow: 0 0 0 0 rgba(46, 204, 113, 0.4);
    }
    50% {
        box-shadow: 0 0 0 12px rgba(46, 204, 113, 0);
    }
}

.read-button:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 30px rgba(46, 204, 113, 0.6);
}

.read-button:active {
    transform: scale(0.98);
}

.read-button i {
    font-size: 20px;
}

/* ========================================
   START BUTTON (Mobile)
   ======================================== */
.start-button {
    position: absolute;
    bottom: 40px;
    left: 50%;
    transform: translateX(-50%);
    padding: 18px 40px;
    background: linear-gradient(135deg, rgba(46, 204, 113, 0.95) 0%, rgba(46, 204, 113, 0.85) 100%);
    border: none;
    border-radius: 50px;
    color: var(--white);
    font-family: 'Montserrat', sans-serif;
    font-size: 18px;
    font-weight: 700;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 12px;
    box-shadow: 0 8px 30px rgba(46, 204, 113, 0.6);
    pointer-events: all;
    transition: var(--transition-fast);
    animation: bounce 2s infinite;
    z-index: 300;
}

@keyframes bounce {
    0%, 100% {
        transform: translateX(-50%) translateY(0);
    }
    50% {
        transform: translateX(-50%) translateY(-10px);
    }
}

.start-button:active {
    transform: translateX(-50%) scale(0.98);
}

.start-button i {
    font-size: 24px;
}

/* ========================================
   CONTENT PANEL
   ======================================== */
.content-panel {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.9);
    background: rgba(255, 255, 255, 0.98);
    backdrop-filter: blur(20px);
    border-radius: 24px;
    width: 90%;
    max-width: 900px;
    max-height: 85vh;
    overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
    pointer-events: none;
    opacity: 0;
    visibility: hidden;
    transition: var(--transition-normal);
    border: 3px solid var(--primary-green);
    z-index: 1000;
}

.content-panel.active {
    opacity: 1;
    visibility: visible;
    transform: translate(-50%, -50%) scale(1);
    pointer-events: all;
}

.content-header {
    background: linear-gradient(135deg, var(--dark-charcoal) 0%, var(--dark-slate) 100%);
    padding: 20px 30px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 3px solid var(--primary-green);
}

.content-header h3 {
    color: var(--white);
    font-size: 26px;
    font-weight: 700;
}

.close-btn {
    background: rgba(255, 255, 255, 0.1);
    border: none;
    width: 45px;
    height: 45px;
    border-radius: 50%;
    color: var(--white);
    font-size: 20px;
    cursor: pointer;
    transition: var(--transition-fast);
    display: flex;
    align-items: center;
    justify-content: center;
}

.close-btn:hover {
    background: var(--primary-green);
    transform: rotate(90deg);
}

.content-body {
    padding: 30px;
}

/* Content Styling */
.news-item {
    margin-bottom: 30px;
    padding-bottom: 30px;
    border-bottom: 2px solid rgba(0, 0, 0, 0.08);
}

.news-item:last-child {
    border-bottom: none;
    margin-bottom: 0;
    padding-bottom: 0;
}

.news-item h4 {
    font-size: 22px;
    margin-bottom: 10px;
    color: var(--dark-charcoal);
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 10px;
}

.news-item h4 i {
    color: var(--primary-green);
    font-size: 20px;
}

.date {
    font-size: 14px;
    color: var(--text-light);
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.date i {
    color: var(--secondary-blue);
}

.news-item p {
    font-size: 16px;
    line-height: 1.7;
    color: var(--text-light);
}

.about-text {
    line-height: 1.8;
    color: var(--text-light);
}

.about-text p {
    margin-bottom: 20px;
    font-size: 16px;
}

.about-text strong {
    color: var(--primary-green);
    font-weight: 700;
}

.mission-values {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
    margin-top: 30px;
}

.value-card {
    background: rgba(46, 204, 113, 0.1);
    padding: 25px;
    border-radius: 12px;
    text-align: center;
    border: 2px solid rgba(46, 204, 113, 0.2);
}

.value-card i {
    font-size: 40px;
    color: var(--primary-green);
    margin-bottom: 15px;
}

.value-card h4 {
    font-size: 18px;
    margin-bottom: 10px;
    color: var(--dark-charcoal);
}

.value-card p {
    font-size: 14px;
    color: var(--text-light);
}

.tips-list {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 25px;
    margin-top: 20px;
}

.tip-item {
    display: flex;
    gap: 15px;
    background: rgba(46, 204, 113, 0.08);
    padding: 20px;
    border-radius: 12px;
    border-left: 4px solid var(--primary-green);
    transition: var(--transition-fast);
}

.tip-item:hover {
    background: rgba(46, 204, 113, 0.15);
    transform: translateX(5px);
}

.tip-item i {
    font-size: 32px;
    color: var(--primary-green);
    min-width: 40px;
}

.tip-item h4 {
    font-size: 18px;
    margin-bottom: 8px;
    color: var(--dark-charcoal);
    font-weight: 700;
}

.tip-item p {
    font-size: 14px;
    color: var(--text-light);
    line-height: 1.6;
}

.projects-list {
    margin-top: 20px;
}

.project-item {
    background: rgba(46, 204, 113, 0.08);
    padding: 20px;
    border-radius: 12px;
    margin-bottom: 15px;
    border-left: 4px solid var(--primary-green);
    display: flex;
    gap: 15px;
}

.project-item .status {
    font-size: 24px;
    min-width: 30px;
}

.project-item h4 {
    font-size: 19px;
    margin-bottom: 8px;
    color: var(--dark-charcoal);
    font-weight: 700;
}

.project-item .period {
    font-size: 14px;
    color: var(--accent-orange);
    margin-bottom: 10px;
    font-weight: 600;
}

.project-item p {
    font-size: 15px;
    color: var(--text-light);
    line-height: 1.6;
}

.blog-list {
    margin-top: 20px;
}

.blog-item {
    background: rgba(46, 204, 113, 0.08);
    padding: 25px;
    border-radius: 12px;
    margin-bottom: 20px;
    border: 2px solid rgba(46, 204, 113, 0.1);
}

.blog-item h4 {
    font-size: 20px;
    margin-bottom: 10px;
    color: var(--dark-charcoal);
    font-weight: 700;
}

.blog-item .meta {
    font-size: 14px;
    color: var(--text-light);
    margin-bottom: 15px;
}

.blog-item .meta i {
    color: var(--secondary-blue);
    margin-right: 5px;
}

.blog-item p {
    font-size: 15px;
    color: var(--text-light);
    line-height: 1.7;
}

/* ========================================
   LOADING OVERLAY
   ======================================== */
.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(44, 62, 80, 0.95);
    backdrop-filter: blur(10px);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    opacity: 0;
    visibility: hidden;
    transition: var(--transition-normal);
    pointer-events: none;
}

.loading-overlay.active {
    opacity: 1;
    visibility: visible;
    pointer-events: all;
}

.loading-spinner {
    width: 60px;
    height: 60px;
    border: 5px solid rgba(46, 204, 113, 0.3);
    border-top-color: var(--primary-green);
    border-radius: 50%;
    margin-bottom: 25px;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

.loading-overlay p {
    color: var(--white);
    font-size: 18px;
    font-weight: 600;
    font-family: 'Montserrat', sans-serif;
}

/* ========================================
   CONTROLS INFO (Desktop)
   ======================================== */
.controls-info {
    position: absolute;
    bottom: 30px;
    right: 30px;
    background: rgba(44, 62, 80, 0.92);
    backdrop-filter: blur(10px);
    border-radius: 16px;
    padding: 15px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    pointer-events: all;
    border: 2px solid rgba(52, 152, 219, 0.3);
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.control-item {
    display: flex;
    align-items: center;
    gap: 10px;
    color: var(--white);
    font-size: 13px;
}

.control-item i {
    font-size: 16px;
    color: var(--primary-green);
    min-width: 20px;
}

/* ========================================
   PRELOADER
   ======================================== */
.preloader {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, var(--dark-slate) 0%, var(--dark-charcoal) 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    transition: var(--transition-slow);
}

.preloader.hidden {
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
}

.preloader-content {
    text-align: center;
    color: var(--white);
}

.tree-icon {
    font-size: 80px;
    color: var(--primary-green);
    margin-bottom: 25px;
    animation: grow 2s ease-in-out infinite;
}

@keyframes grow {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.2); }
}

.preloader h2 {
    font-size: 36px;
    margin-bottom: 15px;
    font-family: 'Montserrat', sans-serif;
    text-shadow: 0 4px 15px rgba(46, 204, 113, 0.5);
}

.preloader p {
    font-size: 18px;
    margin-bottom: 35px;
    color: var(--light-gray);
}

.loading-bar {
    width: 350px;
    height: 8px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 4px;
    overflow: hidden;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
}

.loading-progress {
    height: 100%;
    background: linear-gradient(90deg, var(--primary-green) 0%, var(--secondary-blue) 100%);
    width: 0%;
    transition: width 0.5s ease;
    box-shadow: 0 0 15px rgba(46, 204, 113, 0.5);
}

/* ========================================
   SCROLLBAR
   ======================================== */
::-webkit-scrollbar {
    width: 10px;
}

::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.1);
}

::-webkit-scrollbar-thumb {
    background: var(--primary-green);
    border-radius: 5px;
}

::-webkit-scrollbar-thumb:hover {
    background: var(--primary-green-dark);
}

/* ========================================
   RESPONSIVE STYLES
   ======================================== */
@media (max-width: 768px) {
    .desktop-only {
        display: none;
    }
    
    .mobile-only {
        display: block;
    }
    
    .section-info {
        padding: 15px 20px;
        max-width: 90%;
    }
    
    .section-title {
        font-size: 20px;
    }
    
    .section-description {
        font-size: 13px;
    }
    
    .controls-info {
        display: none;
    }
    
    .content-panel {
        width: 95%;
        max-width: 100%;
    }
    
    .content-body {
        padding: 20px;
    }
    
    .read-button {
        bottom: 130px;
        right: 20px;
        padding: 14px 24px;
        font-size: 14px;
    }
    
    .read-button i {
        font-size: 18px;
    }
    
    .tips-list {
        grid-template-columns: 1fr;
    }
    
    .mission-values {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 480px) {
    .section-info {
        top: 10px;
        padding: 12px 15px;
    }
    
    .section-title {
        font-size: 18px;
    }
    
    .section-description {
        font-size: 12px;
    }
    
    .mobile-nav-menu {
        grid-template-columns: repeat(3, 1fr);
        padding: 15px;
        gap: 10px;
    }
    
    .mobile-nav-item {
        padding: 12px 3px;
        font-size: 11px;
    }
    
    .mobile-nav-item i {
        font-size: 20px;
    }
    
    .mobile-controls {
        bottom: 20px;
        padding: 0 15px;
    }
    
    .joystick-container {
        width: 80px;
        height: 80px;
    }
    
    .joystick-thumb {
        width: 35px;
        height: 35px;
    }
    
    .action-button {
        width: 65px;
        height: 65px;
        font-size: 26px;
    }
    
    .mobile-action-text {
        font-size: 7px;
    }
    
    .read-button {
        display: none;
    }
    
    .start-button {
        bottom: 30px;
        padding: 16px 35px;
        font-size: 16px;
    }
    
    .start-button i {
        font-size: 20px;
    }
    
    .content-header h3 {
        font-size: 22px;
    }
    
    .close-btn {
        width: 40px;
        height: 40px;
        font-size: 18px;
    }
}
    </style>
</head>
<body>
    <!-- Preloader -->
    <div class="preloader">
        <div class="preloader-content">
            <div class="tree-icon">
                <i class="fas fa-tree"></i>
            </div>
            <h2>Yosh Ekologlar</h2>
            <p>O'rmon dunyosiga kirish...</p>
            <div class="loading-bar">
                <div class="loading-progress"></div>
            </div>
        </div>
    </div>

    <!-- 3D Canvas -->
    <div id="canvas-container">
        <canvas id="forest-canvas"></canvas>
    </div>

    <!-- UI Overlay -->
    <div class="forest-ui">
        <!-- Section Info -->
        <div class="section-info">
            <div class="section-title" id="sectionTitle">ðŸŒ² O'rmon Kirishi</div>
            <div class="section-description" id="sectionDescription">
                Xush kelibsiz! Sichqonchani bosib harakatlang yoki tugmalardan foydalaning.
            </div>
        </div>

        <!-- Desktop Navigation -->
        <div class="nav-buttons desktop-only">
            <button class="nav-btn" data-section="about" title="Biz haqimizda - Daryo">
                <i class="fas fa-water"></i>
                <span>Biz haqimizda</span>
            </button>
            <button class="nav-btn" data-section="tips" title="Yashil maslahatlar - Maydon">
                <i class="fas fa-lightbulb"></i>
                <span>Maslahatlar</span>
            </button>
            <button class="nav-btn" data-section="projects" title="Loyihalar - Tog'">
                <i class="fas fa-mountain"></i>
                <span>Loyihalar</span>
            </button>
            <button class="nav-btn" data-section="blog" title="Blog - Kutubxona">
                <i class="fas fa-book"></i>
                <span>Blog</span>
            </button>
            <button class="nav-btn" data-section="news" title="Yangiliklar - Toshlar">
                <i class="fas fa-newspaper"></i>
                <span>Yangiliklar</span>
            </button>
        </div>

        <!-- Mobile Navigation (Bottom Sheet) -->
        <div class="mobile-nav mobile-only">
            <button class="mobile-nav-toggle" id="mobileNavToggle">
                <i class="fas fa-compass"></i>
                <span>Bo'limlar</span>
            </button>
            <div class="mobile-nav-menu" id="mobileNavMenu">
                <button class="mobile-nav-item" data-section="about">
                    <i class="fas fa-water"></i>
                    <span>Biz haqimizda</span>
                </button>
                <button class="mobile-nav-item" data-section="tips">
                    <i class="fas fa-lightbulb"></i>
                    <span>Maslahatlar</span>
                </button>
                <button class="mobile-nav-item" data-section="projects">
                    <i class="fas fa-mountain"></i>
                    <span>Loyihalar</span>
                </button>
                <button class="mobile-nav-item" data-section="blog">
                    <i class="fas fa-book"></i>
                    <span>Blog</span>
                </button>
                <button class="mobile-nav-item" data-section="news">
                    <i class="fas fa-newspaper"></i>
                    <span>Yangiliklar</span>
                </button>
            </div>
        </div>

        <!-- Mobile Controls -->
        <div class="mobile-controls mobile-only">
            <!-- Joystick -->
            <div class="joystick-container" id="joystickContainer">
                <div class="joystick-base"></div>
                <div class="joystick-thumb"></div>
            </div>
            
            <!-- Action Button - FIXED FOR MOBILE -->
            <button class="action-button" id="mobileActionButton" title="O'qish">
                <i class="fas fa-book-open"></i>
                <span class="mobile-action-text">O'qish</span>
            </button>
        </div>

        <!-- Read Button (Desktop) -->
        <button class="read-button desktop-only" id="desktopReadButton" title="O'qish (E)">
            <i class="fas fa-book-open"></i>
            <span>O'qish</span>
        </button>

        <!-- Content Panel -->
        <div class="content-panel" id="contentPanel">
            <div class="content-header">
                <h3 id="panelTitle">Yangiliklar</h3>
                <button class="close-btn" id="closePanel">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="content-body" id="contentBody">
                <!-- Content will be loaded here -->
            </div>
        </div>

        <!-- Loading Indicator -->
        <div class="loading-overlay" id="loadingOverlay">
            <div class="loading-spinner"></div>
            <p>Sayohat davom etmoqda...</p>
        </div>

        <!-- Controls Info (Desktop only) -->
        <div class="controls-info desktop-only">
            <div class="control-item">
                <i class="fas fa-mouse-pointer"></i>
                <span>Sichqoncha - Aylanish</span>
            </div>
            <div class="control-item">
                <i class="fas fa-keyboard"></i>
                <span>WASD - Yurish</span>
            </div>
            <div class="control-item">
                <i class="fas fa-door-open"></i>
                <span>ESC - Chiqish</span>
            </div>
            <div class="control-item">
                <i class="fas fa-book-open"></i>
                <span>E - O'qish</span>
            </div>
        </div>

        <!-- Start Button (Mobile) -->
        <button class="start-button mobile-only" id="startButton">
            <i class="fas fa-play"></i>
            <span>O'rmonni o'rganish</span>
        </button>
    </div>

    <!-- Hidden Content Templates -->
    <div id="contentTemplates" style="display: none;">
        <!-- News Content -->
        <div id="newsContent">
            <div class="news-item">
                <h4><i class="fas fa-seedling"></i> Yosh ekologlar 1000 daraxt ekdilar!</h4>
                <p class="date"><i class="fas fa-calendar"></i> 16.02.2026</p>
                <p>
                    Bugun Toshkent shahrida yoshlar 1000 ta meva daraxtlari ekdilar. Bu loyiha 500 dan ortiq yoshlarning ishtiroki bilan amalga oshirildi. Har bir ekilgan daraxt - kelajak avlodlar uchun qo'yilgan ishonchli qadam.
                </p>
            </div>
            <div class="news-item">
                <h4><i class="fas fa-tint"></i> Chirchiq daryosini tozalash boshlandi</h4>
                <p class="date"><i class="fas fa-calendar"></i> 14.02.2026</p>
                <p>
                    Chirchiq daryosini tozalash dasturi boshlandi. Birinchi bosqichda 300 yosh ishtirok etdi va 5 tonna axlat yig'ildi. Bu loyiha shahar ekologik muhitini yaxshilashga katta hissa qo'shadi.
                </p>
            </div>
            <div class="news-item">
                <h4><i class="fas fa-park"></i> Yangi "Yoshlar Parki" loyihasi e'lon qilindi</h4>
                <p class="date"><i class="fas fa-calendar"></i> 12.02.2026</p>
                <p>
                    Shahar hokimiyati bilan hamkorlikda yangi park yaratish loyihasi boshlandi. Park yoshlar uchun ekologik markaz bo'ladi va ko'plab yashil zonalarni o'z ichiga oladi.
                </p>
            </div>
        </div>

        <!-- About Content -->
        <div id="aboutContent">
            <h3><i class="fas fa-water"></i> Daryo Bo'yida - Biz Haqimizda</h3>
            <div class="about-text">
                <p>
                    <strong>Yosh Ekologlar</strong> - bu tabiatni muhofaza qilishga qaratilgan yoshlar jamoasi. Biz o'zimiz yashab turgan hududlarni yashil va go'zal qilish uchun birgalikda ishlaymiz.
                </p>
                <p>
                    Har kunning o'zida yuzlab daraxtlar kesilmoqda, lekin biz bunga to'g'ri kelmaymiz. Har bir ekilgan daraxt - kelajak avlodlar uchun qo'yilgan ishonchli qadam.
                </p>
                <p>
                    Bizning maqsadimiz - yoshlarni tabiatni asrashga undash, amaliy ko'nikmalar berish va ularni faol fuqarolarga aylantirish.
                </p>
                <div class="mission-values">
                    <div class="value-card">
                        <i class="fas fa-heart"></i>
                        <h4>Sevgi</h4>
                        <p>Tabiatga muhabbat bilan yondashamiz</p>
                    </div>
                    <div class="value-card">
                        <i class="fas fa-hands"></i>
                        <h4>Amaliyot</h4>
                        <p>Gap emas, ish bilan isbotlaymiz</p>
                    </div>
                    <div class="value-card">
                        <i class="fas fa-users"></i>
                        <h4>Jamoa</h4>
                        <p>Birgalikda kuchliroqmiz</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tips Content -->
        <div id="tipsContent">
            <h3><i class="fas fa-lightbulb"></i> Ochiq Maydon - Yashil Maslahatlar</h3>
            <div class="tips-list">
                <div class="tip-item">
                    <i class="fas fa-tint"></i>
                    <div>
                        <h4>Suvni tejang</h4>
                        <p>Changlatish paytida suvni oqib ketishini oldini oling.</p>
                    </div>
                </div>
                <div class="tip-item">
                    <i class="fas fa-recycle"></i>
                    <div>
                        <h4>Qayta ishlash</h4>
                        <p>Qog'oz, plastik va shisha idishlarni alohida yig'ing.</p>
                    </div>
                </div>
                <div class="tip-item">
                    <i class="fas fa-bicycle"></i>
                    <div>
                        <h4>Velosipedda yuring</h4>
                        <p>Havo ifloslanishini kamaytiring.</p>
                    </div>
                </div>
                <div class="tip-item">
                    <i class="fas fa-seedling"></i>
                    <div>
                        <h4>Uy daraxtlari</h4>
                        <p>Uyingiz atrofida daraxt ekish - eng oddiy yashil ish.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Projects Content -->
        <div id="projectsContent">
            <h3><i class="fas fa-mountain"></i> Tog' Yonbag'iri - Loyihalar</h3>
            <div class="projects-list">
                <div class="project-item">
                    <span class="status">âœ…</span>
                    <h4>1000 Daraxt Ekish</h4>
                    <p class="period">Yanvar - Mart 2026</p>
                    <p>500+ yosh ishtirok etdi, 1000 ta meva daraxti ekildi.</p>
                </div>
                <div class="project-item">
                    <span class="status">ðŸ”„</span>
                    <h4>Suv Tozalash Dasturi</h4>
                    <p class="period">Fevral - Aprel 2026</p>
                    <p>Chirchiq daryosini tozalash va atrofidagi hududni yashillantirish.</p>
                </div>
                <div class="project-item">
                    <span class="status">ðŸ“…</span>
                    <h4>Yoshlar Parki</h4>
                    <p class="period">May - Iyun 2026</p>
                    <p>Yangi park yaratish va uni yoshlar uchun ekologik markazga aylantirish.</p>
                </div>
            </div>
        </div>

        <!-- Blog Content -->
        <div id="blogContent">
            <h3><i class="fas fa-book"></i> Kutubxona - Blog</h3>
            <div class="blog-list">
                <div class="blog-item">
                    <h4>Global Isish va Bizning Kelajagimiz</h4>
                    <p class="meta"><i class="fas fa-calendar"></i> 15.02.2026 | <i class="fas fa-clock"></i> 5 min</p>
                    <p>Global isish dunyo bo'yicha haroratning ortib borayotgan holati...</p>
                </div>
                <div class="blog-item">
                    <h4>Plastik Ifloslanishdan Qutulish</h4>
                    <p class="meta"><i class="fas fa-calendar"></i> 12.02.2026 | <i class="fas fa-clock"></i> 4 min</p>
                    <p>Har yili millionlab tonna plastik okeanlarga tushadi...</p>
                </div>
                <div class="blog-item">
                    <h4>Uy Daraxtlari: Qanday Ekish Kerak?</h4>
                    <p class="meta"><i class="fas fa-calendar"></i> 10.02.2026 | <i class="fas fa-clock"></i> 6 min</p>
                    <p>Uyingiz atrofida daraxt ekish - eng oddiy va samarali yashil ish...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Three.js Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/PointerLockControls.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.2/dist/gsap.min.js"></script>
    
    <!-- Main JavaScript -->
    <script>
      // ========================================
// GLOBAL VARIABLES
// ========================================
let scene, camera, renderer, controls;
let currentSection = 'home';
let isPanelOpen = false;
let isMobile = false;
let moveForward = false;
let moveBackward = false;
let moveLeft = false;
let moveRight = false;
let canJump = false;
let joystickActive = false;
let joystickData = { x: 0, y: 0 };
let trees = [];
let flowers = [];
let grass = [];
let birds = [];
let clouds = [];
let stars = [];
let skyDome = null;

// Movement speed - TEZROQ
const MOVE_SPEED = 30.0; // Oldingi 20.0 dan oshirildi
const JUMP_HEIGHT = 0.5;

// Detect mobile
function detectMobile() {
    const toMatch = [
        /Android/i,
        /webOS/i,
        /iPhone/i,
        /iPad/i,
        /iPod/i,
        /BlackBerry/i,
        /Windows Phone/i
    ];
    
    return toMatch.some((toMatchItem) => {
        return navigator.userAgent.match(toMatchItem);
    });
}

isMobile = detectMobile();

// Section positions
const sectionPositions = {
    home: { x: 0, y: 2, z: 0 },
    about: { x: -60, y: 2, z: 40 },
    tips: { x: 60, y: 2, z: 40 },
    projects: { x: 0, y: 2, z: -80 },
    blog: { x: -50, y: 2, z: -60 },
    news: { x: 50, y: 2, z: -60 }
};

// Section info
const sectionInfo = {
    home: {
        title: "ðŸŒ² O'rmon Kirishi",
        description: isMobile ? 
            "Xush kelibsiz! Joystick bilan harakatlaning, pastdagi yashil tugmani bosing." : 
            "Xush kelibsiz! Sichqonchani bosib harakatlang yoki tugmalardan foydalaning."
    },
    about: {
        title: "ðŸŒŠ Daryo Bo'yida",
        description: "Bu yerda biz haqimizda ma'lumot topasiz. Suv tozaligi - hayot manbai."
    },
    tips: {
        title: "ðŸ’¡ Ochiq Maydon",
        description: "Kundalik hayotingizni yashillantirish uchun foydali maslahatlar."
    },
    projects: {
        title: "ðŸ”ï¸ Tog' Yonbag'iri",
        description: "Bizning muvaffaqiyatli ekologik loyihalarimiz."
    },
    blog: {
        title: "ðŸ“š Kutubxona",
        description: "Ekologik bilimlar va maqolalar to'plami."
    },
    news: {
        title: "ðŸ“° Toshlar Maydoni",
        description: "Eng so'nggi yangiliklar va tadbirlar."
    }
};

// ========================================
// INITIALIZATION
// ========================================
function init() {
    // Scene
    scene = new THREE.Scene();
    scene.fog = new THREE.Fog(0x88cc88, 100, 400);
    
    // Camera
    camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 2000);
    camera.position.set(0, 1.8, 5);
    
    // Renderer - HIGH QUALITY
    renderer = new THREE.WebGLRenderer({ 
        canvas: document.getElementById('forest-canvas'),
        antialias: true,
        alpha: true,
        logarithmicDepthBuffer: true
    });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    renderer.shadowMap.enabled = true;
    renderer.shadowMap.type = THREE.PCFSoftShadowMap;
    renderer.toneMapping = THREE.ACESFilmicToneMapping;
    renderer.toneMappingExposure = 1.2;
    renderer.outputEncoding = THREE.sRGBEncoding;
    
    // Controls
    controls = new THREE.PointerLockControls(camera, document.body);
    
    // Click to start (Desktop)
    if (!isMobile) {
        document.addEventListener('click', () => {
            if (!controls.isLocked) {
                controls.lock();
            }
        });
    }
    
    scene.add(controls.getObject());
    
    // Lights - REALISTIC
    addLights();
    
    // Sky - REALISTIC SKY DOME
    createSkyDome();
    
    // Stars
    createStars();
    
    // Clouds
    createClouds();
    
    // Environment - REALISTIC
    createEnvironment();
    
    // Sections
    createSections();
    
    // Events
    addEventListeners();
    
    // Start
    animate();
    
    // Update UI
    updateSectionInfo();
    
    // Hide start button on mobile after init
    if (isMobile) {
        setTimeout(() => {
            const startBtn = document.getElementById('startButton');
            if (startBtn) {
                startBtn.style.display = 'none';
            }
        }, 3000);
    }
}

// ========================================
// CREATE REALISTIC SKY DOME
// ========================================
function createSkyDome() {
    // Sky gradient dome
    const skyGeo = new THREE.SphereGeometry(1000, 64, 32);
    const skyMat = new THREE.MeshPhongMaterial({
        side: THREE.BackSide,
        fog: false,
        transparent: true,
        opacity: 0.9
    });
    
    // Create gradient texture for sky
    const canvas = document.createElement('canvas');
    canvas.width = 1024;
    canvas.height = 1024;
    const ctx = canvas.getContext('2d');
    
    // Create radial gradient (blue sky)
    const gradient = ctx.createRadialGradient(
        canvas.width / 2, canvas.height / 2, 0,
        canvas.width / 2, canvas.height / 2, canvas.width / 2
    );
    gradient.addColorStop(0, '#87CEEB'); // Light blue (zenith)
    gradient.addColorStop(0.6, '#4682B4'); // Medium blue
    gradient.addColorStop(1, '#1E90FF'); // Deep blue (horizon)
    
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // Add some clouds to sky texture
    for (let i = 0; i < 20; i++) {
        ctx.fillStyle = `rgba(255, 255, 255, ${Math.random() * 0.2 + 0.1})`;
        const x = Math.random() * canvas.width;
        const y = Math.random() * canvas.height * 0.6 + canvas.height * 0.2;
        const size = Math.random() * 100 + 50;
        ctx.beginPath();
        ctx.arc(x, y, size, 0, Math.PI * 2);
        ctx.fill();
    }
    
    const skyTexture = new THREE.CanvasTexture(canvas);
    skyMat.map = skyTexture;
    
    skyDome = new THREE.Mesh(skyGeo, skyMat);
    scene.add(skyDome);
}

// ========================================
// CREATE STARS
// ========================================
function createStars() {
    const starGeometry = new THREE.BufferGeometry();
    const starMaterial = new THREE.PointsMaterial({
        color: 0xFFFFFF,
        size: 0.5,
        transparent: true,
        opacity: 0.8,
        sizeAttenuation: true
    });
    
    const starVertices = [];
    for (let i = 0; i < 5000; i++) {
        const x = (Math.random() - 0.5) * 2000;
        const y = Math.random() * 1000 + 100;
        const z = (Math.random() - 0.5) * 2000;
        starVertices.push(x, y, z);
    }
    
    starGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starVertices, 3));
    const stars = new THREE.Points(starGeometry, starMaterial);
    scene.add(stars);
}

// ========================================
// CREATE CLOUDS
// ========================================
function createClouds() {
    for (let i = 0; i < 30; i++) {
        const cloudSize = 15 + Math.random() * 10;
        
        // Create cloud cluster
        const cloudGroup = new THREE.Group();
        
        // Multiple spheres for fluffy cloud effect
        for (let j = 0; j < 8; j++) {
            const sphereGeo = new THREE.SphereGeometry(3 + Math.random() * 2, 16, 16);
            const sphereMat = new THREE.MeshPhongMaterial({
                color: 0xFFFFFF,
                transparent: true,
                opacity: 0.8 - Math.random() * 0.3,
                shininess: 20
            });
            const sphere = new THREE.Mesh(sphereGeo, sphereMat);
            
            // Random position within cloud cluster
            sphere.position.set(
                (Math.random() - 0.5) * cloudSize,
                (Math.random() - 0.5) * cloudSize * 0.5,
                (Math.random() - 0.5) * cloudSize
            );
            
            sphere.castShadow = true;
            cloudGroup.add(sphere);
        }
        
        // Position cloud in sky
        const distance = 150 + Math.random() * 200;
        const angle = Math.random() * Math.PI * 2;
        const x = Math.cos(angle) * distance;
        const z = Math.sin(angle) * distance;
        const y = 80 + Math.random() * 40;
        
        cloudGroup.position.set(x, y, z);
        cloudGroup.scale.set(1 + Math.random(), 1 + Math.random(), 1 + Math.random());
        
        scene.add(cloudGroup);
        clouds.push({
            mesh: cloudGroup,
            speed: 0.002 + Math.random() * 0.003,
            direction: Math.random() * Math.PI * 2
        });
    }
}

// ========================================
// ADD LIGHTS (Realistic - ENHANCED)
// ========================================
function addLights() {
    // Ambient light (soft)
    const ambient = new THREE.AmbientLight(0xffffff, 0.3);
    scene.add(ambient);
    
    // Directional light (Sun - realistic)
    const sun = new THREE.DirectionalLight(0xffeecc, 1.5);
    sun.position.set(100, 150, 100);
    sun.castShadow = true;
    
    // Enhanced shadow settings for realism
    sun.shadow.mapSize.width = 4096;
    sun.shadow.mapSize.height = 4096;
    sun.shadow.camera.near = 0.5;
    sun.shadow.camera.far = 1000;
    sun.shadow.camera.left = -200;
    sun.shadow.camera.right = 200;
    sun.shadow.camera.top = 200;
    sun.shadow.camera.bottom = -200;
    sun.shadow.bias = -0.0001;
    sun.shadow.normalBias = 0.01;
    
    scene.add(sun);
    
    // Hemisphere light (sky/ground) - ENHANCED
    const hemi = new THREE.HemisphereLight(0x88ccff, 0x448822, 0.8);
    scene.add(hemi);
    
    // Additional fill lights for realism
    const fillLight1 = new THREE.DirectionalLight(0xffffff, 0.4);
    fillLight1.position.set(-80, 60, 60);
    fillLight1.castShadow = true;
    scene.add(fillLight1);
    
    const fillLight2 = new THREE.DirectionalLight(0xffffff, 0.4);
    fillLight2.position.set(80, 60, -60);
    fillLight2.castShadow = true;
    scene.add(fillLight2);
    
    // Warm fill light (sunset effect)
    const warmLight = new THREE.DirectionalLight(0xffaa66, 0.3);
    warmLight.position.set(50, 40, -50);
    scene.add(warmLight);
}

// ========================================
// CREATE ENVIRONMENT (Realistic - ENHANCED)
// ========================================
function createEnvironment() {
    // Ground with realistic texture
    const groundGeo = new THREE.PlaneGeometry(800, 800, 200, 200);
    const groundMat = new THREE.MeshStandardMaterial({ 
        color: 0x6B8E23,
        roughness: 1,
        metalness: 0,
        bumpScale: 0.1
    });
    const ground = new THREE.Mesh(groundGeo, groundMat);
    ground.rotation.x = -Math.PI / 2;
    ground.position.y = -0.1;
    ground.receiveShadow = true;
    scene.add(ground);
    
    // Add detailed grass patches
    generateDetailedGrass(500);
    
    // Trees (Realistic - ENHANCED)
    generateRealisticTrees(200);
    
    // Flowers (More variety)
    generateFlowers(150);
    
    // Rocks (More realistic)
    generateRealisticRocks(80);
    
    // Water (River - ENHANCED)
    createRealisticWater();
    
    // Birds (More realistic)
    generateRealisticBirds(30);
}

// ========================================
// GENERATE DETAILED GRASS
// ========================================
function generateDetailedGrass(count) {
    for (let i = 0; i < count; i++) {
        const dist = Math.random() * 180 + 10;
        const angle = Math.random() * Math.PI * 2;
        const x = Math.cos(angle) * dist;
        const z = Math.sin(angle) * dist;
        
        // Create multiple grass blades in cluster
        const clusterSize = 3 + Math.floor(Math.random() * 3);
        
        for (let j = 0; j < clusterSize; j++) {
            const bladeHeight = 0.4 + Math.random() * 0.8;
            const bladeGeo = new THREE.CylinderGeometry(0.02, 0.08, bladeHeight, 6, 1, true);
            const bladeMat = new THREE.MeshStandardMaterial({ 
                color: j === 0 ? 0x4A7A3C : 0x558833,
                roughness: 1,
                flatShading: true
            });
            const blade = new THREE.Mesh(bladeGeo, bladeMat);
            blade.position.set(
                x + (Math.random() - 0.5) * 0.5,
                bladeHeight / 2,
                z + (Math.random() - 0.5) * 0.5
            );
            blade.rotation.y = Math.random() * Math.PI;
            blade.rotation.z = (Math.random() - 0.5) * 0.2;
            blade.castShadow = true;
            scene.add(blade);
            
            grass.push(blade);
        }
    }
}

// ========================================
// GENERATE REALISTIC TREES (ENHANCED)
// ========================================
function generateRealisticTrees(count) {
    for (let i = 0; i < count; i++) {
        const dist = Math.random() * 200 + 20;
        const angle = Math.random() * Math.PI * 2;
        const x = Math.cos(angle) * dist;
        const z = Math.sin(angle) * dist;
        
        const height = 10 + Math.random() * 15;
        const scale = 0.8 + Math.random() * 0.7;
        
        // Trunk with bark texture simulation
        const trunkGeo = new THREE.CylinderGeometry(1.2, 1.8, height, 12);
        const trunkMat = new THREE.MeshStandardMaterial({ 
            color: 0x5D4037,
            roughness: 1,
            metalness: 0
        });
        const trunk = new THREE.Mesh(trunkGeo, trunkMat);
        trunk.position.set(x, height / 2 - 0.1, z);
        trunk.scale.set(scale, scale, scale);
        trunk.castShadow = true;
        trunk.receiveShadow = true;
        scene.add(trunk);
        
        // Multiple foliage layers with variation
        const foliageLayers = 4 + Math.floor(Math.random() * 3);
        
        for (let layer = 0; layer < foliageLayers; layer++) {
            const layerHeight = height * 0.25 + (layer * height * 0.2);
            const layerScale = 1 - (layer * 0.15);
            
            const foliageGeo = new THREE.ConeGeometry(6 * layerScale, height * 0.5 * layerScale, 12);
            const foliageMat = new THREE.MeshStandardMaterial({ 
                color: layer === 0 ? 0x1B5E20 : (layer === 1 ? 0x2E7D32 : 0x388E3C),
                roughness: 1,
                metalness: 0,
                transparent: true,
                opacity: 0.95
            });
            const foliage = new THREE.Mesh(foliageGeo, foliageMat);
            foliage.position.set(
                x + (Math.random() - 0.5) * 0.5,
                layerHeight + height * 0.1 - 0.1,
                z + (Math.random() - 0.5) * 0.5
            );
            foliage.scale.set(scale * layerScale, scale * layerScale * 0.8, scale * layerScale);
            foliage.rotation.y = Math.random() * Math.PI;
            foliage.castShadow = true;
            scene.add(foliage);
        }
        
        // Add some moss on trunk bottom
        if (Math.random() > 0.5) {
            const mossGeo = new THREE.SphereGeometry(1.5, 16, 16);
            const mossMat = new THREE.MeshStandardMaterial({ 
                color: 0x4A7A3C,
                roughness: 1
            });
            const moss = new THREE.Mesh(mossGeo, mossMat);
            moss.position.set(x, height * 0.1, z);
            moss.scale.set(scale * 0.8, scale * 0.3, scale * 0.8);
            moss.castShadow = true;
            scene.add(moss);
        }
        
        trees.push({ trunk, position: { x, z } });
    }
}

// ========================================
// GENERATE FLOWERS (ENHANCED)
// ========================================
function generateFlowers(count) {
    const flowerTypes = [
        { color: 0xFF69B4, name: 'Rose' },      // Pink
        { color: 0xFF1493, name: 'Carnation' }, // Deep Pink
        { color: 0x9370DB, name: 'Lavender' },  // Purple
        { color: 0x8A2BE2, name: 'Violet' },    // Blue Violet
        { color: 0x4169E1, name: 'Bluebell' },  // Royal Blue
        { color: 0xFFD700, name: 'Sunflower' }, // Gold
        { color: 0xFF4500, name: 'Poppy' }      // Orange Red
    ];
    
    for (let i = 0; i < count; i++) {
        const dist = Math.random() * 140 + 10;
        const angle = Math.random() * Math.PI * 2;
        const x = Math.cos(angle) * dist;
        const z = Math.sin(angle) * dist;
        
        const type = flowerTypes[Math.floor(Math.random() * flowerTypes.length)];
        
        // Flower stem with leaves
        const stemGeo = new THREE.CylinderGeometry(0.06, 0.1, 0.6, 8);
        const stemMat = new THREE.MeshStandardMaterial({ color: 0x3A5F0B });
        const stem = new THREE.Mesh(stemGeo, stemMat);
        stem.position.set(x, 0.4, z);
        stem.castShadow = true;
        scene.add(stem);
        
        // Add leaves
        for (let j = 0; j < 2 + Math.floor(Math.random() * 2); j++) {
            const leafGeo = new THREE.SphereGeometry(0.2, 16, 16);
            const leafMat = new THREE.MeshStandardMaterial({ 
                color: 0x2D5016,
                transparent: true,
                opacity: 0.9
            });
            const leaf = new THREE.Mesh(leafGeo, leafMat);
            leaf.position.set(
                x + (Math.random() - 0.5) * 0.3,
                0.3 + j * 0.2,
                z + (Math.random() - 0.5) * 0.3
            );
            leaf.scale.set(0.8, 0.3, 1.2);
            leaf.rotation.y = Math.random() * Math.PI;
            leaf.castShadow = true;
            scene.add(leaf);
        }
        
        // Flower head with petals
        const headGeo = new THREE.SphereGeometry(0.25, 32, 32);
        const headMat = new THREE.MeshStandardMaterial({ 
            color: type.color,
            roughness: 0.5,
            metalness: 0.2
        });
        const head = new THREE.Mesh(headGeo, headMat);
        head.position.set(x, 0.85, z);
        head.castShadow = true;
        scene.add(head);
        
        flowers.push({ stem, head });
    }
}

// ========================================
// GENERATE REALISTIC ROCKS
// ========================================
function generateRealisticRocks(count) {
    for (let i = 0; i < count; i++) {
        const dist = Math.random() * 160 + 10;
        const angle = Math.random() * Math.PI * 2;
        const x = Math.cos(angle) * dist;
        const z = Math.sin(angle) * dist;
        
        // Create irregular rock shape
        const rockGeo = new THREE.DodecahedronGeometry(2.5 + Math.random() * 3, 2);
        const rockMat = new THREE.MeshStandardMaterial({ 
            color: 0x777777,
            roughness: 1,
            metalness: 0.1
        });
        const rock = new THREE.Mesh(rockGeo, rockMat);
        rock.position.set(x, 1.8 + Math.random() * 3, z);
        rock.rotation.set(
            Math.random() * Math.PI,
            Math.random() * Math.PI,
            Math.random() * Math.PI
        );
        rock.scale.set(
            0.8 + Math.random() * 0.6,
            0.8 + Math.random() * 0.6,
            0.8 + Math.random() * 0.6
        );
        rock.castShadow = true;
        rock.receiveShadow = true;
        scene.add(rock);
        
        // Add moss on some rocks
        if (Math.random() > 0.6) {
            const mossGeo = new THREE.SphereGeometry(1 + Math.random(), 16, 16);
            const mossMat = new THREE.MeshStandardMaterial({ 
                color: 0x4A7A3C,
                roughness: 1,
                transparent: true,
                opacity: 0.7
            });
            const moss = new THREE.Mesh(mossGeo, mossMat);
            moss.position.set(
                x + (Math.random() - 0.5) * 1.5,
                rock.position.y + 1 + Math.random(),
                z + (Math.random() - 0.5) * 1.5
            );
            moss.scale.set(1.5, 0.5, 1.5);
            scene.add(moss);
        }
    }
}

// ========================================
// GENERATE REALISTIC BIRDS
// ========================================
function generateRealisticBirds(count) {
    for (let i = 0; i < count; i++) {
        const dist = Math.random() * 120 + 20;
        const angle = Math.random() * Math.PI * 2;
        const x = Math.cos(angle) * dist;
        const z = Math.sin(angle) * dist;
        const y = 15 + Math.random() * 30;
        
        // Create bird with wings
        const birdGroup = new THREE.Group();
        
        // Body
        const bodyGeo = new THREE.SphereGeometry(0.3, 16, 16);
        const bodyMat = new THREE.MeshStandardMaterial({ 
            color: 0x4682B4,
            roughness: 0.7
        });
        const body = new THREE.Mesh(bodyGeo, bodyMat);
        birdGroup.add(body);
        
        // Wings
        const wingGeo = new THREE.ConeGeometry(0.1, 0.8, 8);
        const wingMat = new THREE.MeshStandardMaterial({ 
            color: 0x2F4F4F,
            roughness: 0.8
        });
        
        const leftWing = new THREE.Mesh(wingGeo, wingMat);
        leftWing.position.set(-0.4, 0, 0);
        leftWing.rotation.z = -Math.PI / 4;
        birdGroup.add(leftWing);
        
        const rightWing = new THREE.Mesh(wingGeo, wingMat);
        rightWing.position.set(0.4, 0, 0);
        rightWing.rotation.z = Math.PI / 4;
        birdGroup.add(rightWing);
        
        // Tail
        const tailGeo = new THREE.ConeGeometry(0.08, 0.4, 8);
        const tailMat = new THREE.MeshStandardMaterial({ 
            color: 0x4682B4,
            roughness: 0.7
        });
        const tail = new THREE.Mesh(tailGeo, tailMat);
        tail.position.set(0, -0.2, -0.3);
        tail.rotation.x = Math.PI / 3;
        birdGroup.add(tail);
        
        birdGroup.position.set(x, y, z);
        birdGroup.rotation.z = Math.PI / 2;
        birdGroup.rotation.y = Math.random() * Math.PI;
        scene.add(birdGroup);
        
        birds.push({
            mesh: birdGroup,
            leftWing: leftWing,
            rightWing: rightWing,
            speed: 0.01 + Math.random() * 0.03,
            angle: Math.random() * Math.PI * 2,
            radius: 20 + Math.random() * 15,
            height: y,
            center: { x: x, z: z },
            wingAngle: 0
        });
    }
}

// ========================================
// CREATE REALISTIC WATER
// ========================================
function createRealisticWater() {
    const waterGeo = new THREE.PlaneGeometry(120, 400, 128, 128);
    const waterMat = new THREE.MeshStandardMaterial({
        color: 0x4682B4,
        roughness: 0.1,
        metalness: 0.8,
        transparent: true,
        opacity: 0.8,
        envMap: createWaterReflection()
    });
    const water = new THREE.Mesh(waterGeo, waterMat);
    water.rotation.x = -Math.PI / 2;
    water.position.set(-60, 0.1, 40);
    water.receiveShadow = true;
    scene.add(water);
}

function createWaterReflection() {
    const canvas = document.createElement('canvas');
    canvas.width = 512;
    canvas.height = 512;
    const ctx = canvas.getContext('2d');
    
    // Create water reflection gradient
    const gradient = ctx.createLinearGradient(0, 0, 0, 512);
    gradient.addColorStop(0, '#87CEEB');
    gradient.addColorStop(0.5, '#4682B4');
    gradient.addColorStop(1, '#1E90FF');
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, 512, 512);
    
    // Add wave patterns
    for (let i = 0; i < 20; i++) {
        ctx.fillStyle = `rgba(255, 255, 255, ${Math.random() * 0.1})`;
        const y = Math.random() * 512;
        const height = Math.random() * 20 + 5;
        ctx.fillRect(0, y, 512, height);
    }
    
    return new THREE.CanvasTexture(canvas);
}

// ========================================
// CREATE SECTIONS
// ========================================
function createSections() {
    Object.keys(sectionPositions).forEach(section => {
        const pos = sectionPositions[section];
        
        // Marker with enhanced glow
        const markerGeo = new THREE.SphereGeometry(3, 64, 64);
        const markerMat = new THREE.MeshStandardMaterial({
            color: 0x2ecc71,
            emissive: 0x22aa44,
            emissiveIntensity: 0.8,
            transparent: true,
            opacity: 0.9
        });
        const marker = new THREE.Mesh(markerGeo, markerMat);
        marker.position.set(pos.x, pos.y + 3, pos.z);
        marker.userData = { section };
        scene.add(marker);
        
        // Add section name plate
        const plateGeo = new THREE.PlaneGeometry(15, 4);
        const plateMat = new THREE.MeshStandardMaterial({
            color: 0xffffff,
            side: THREE.DoubleSide
        });
        const plate = new THREE.Mesh(plateGeo, plateMat);
        plate.position.set(pos.x, pos.y + 5, pos.z);
        plate.rotation.y = Math.PI;
        scene.add(plate);
    });
}

// ========================================
// SMOOTH MOVE TO SECTION
// ========================================
function moveToSection(sectionName) {
    if (!sectionPositions[sectionName] || currentSection === sectionName) return;
    
    const target = sectionPositions[sectionName];
    
    // Show loading
    document.getElementById('loadingOverlay').classList.add('active');
    
    // Unlock controls during transition
    if (controls.isLocked) {
        controls.unlock();
    }
    
    // Smooth camera movement with path
    const duration = 2;
    
    gsap.to(camera.position, {
        x: target.x,
        y: target.y + 1.8,
        z: target.z + 10,
        duration: duration,
        ease: "power2.inOut",
        onUpdate: () => {
            camera.lookAt(target.x, target.y, target.z);
        },
        onComplete: () => {
            currentSection = sectionName;
            updateSectionInfo();
            document.getElementById('loadingOverlay').classList.remove('active');
            
            // Lock controls again on desktop
            if (!isMobile) {
                setTimeout(() => {
                    controls.lock();
                }, 500);
            }
        }
    });
}

// ========================================
// UPDATE SECTION INFO
// ========================================
function updateSectionInfo() {
    const info = sectionInfo[currentSection];
    document.getElementById('sectionTitle').textContent = info.title;
    document.getElementById('sectionDescription').textContent = info.description;
}

// ========================================
// OPEN CONTENT PANEL
// ========================================
function openContentPanel() {
    if (currentSection === 'home') return;
    
    const panel = document.getElementById('contentPanel');
    const body = document.getElementById('contentBody');
    const title = document.getElementById('panelTitle');
    
    // Set content
    let content = '';
    let titleText = '';
    
    switch(currentSection) {
        case 'about':
            content = document.getElementById('aboutContent').innerHTML;
            titleText = 'ðŸŒŠ Biz Haqimizda';
            break;
        case 'tips':
            content = document.getElementById('tipsContent').innerHTML;
            titleText = 'ðŸ’¡ Yashil Maslahatlar';
            break;
        case 'projects':
            content = document.getElementById('projectsContent').innerHTML;
            titleText = 'ðŸ”ï¸ Loyihalar';
            break;
        case 'blog':
            content = document.getElementById('blogContent').innerHTML;
            titleText = 'ðŸ“š Blog';
            break;
        case 'news':
            content = document.getElementById('newsContent').innerHTML;
            titleText = 'ðŸ“° Yangiliklar';
            break;
    }
    
    body.innerHTML = content;
    title.textContent = titleText;
    
    panel.classList.add('active');
    isPanelOpen = true;
    
    // Unlock controls
    if (controls.isLocked) {
        controls.unlock();
    }
}

// ========================================
// CLOSE CONTENT PANEL
// ========================================
function closeContentPanel() {
    document.getElementById('contentPanel').classList.remove('active');
    isPanelOpen = false;
    
    // Lock controls on desktop
    if (!isMobile && !controls.isLocked) {
        setTimeout(() => {
            controls.lock();
        }, 500);
    }
}

// ========================================
// SETUP JOYSTICK (Mobile) - FIXED
// ========================================
function setupJoystick() {
    const joystickContainer = document.getElementById('joystickContainer');
    const joystickThumb = document.querySelector('.joystick-thumb');
    
    if (!joystickContainer || !joystickThumb) return;
    
    const baseRect = joystickContainer.getBoundingClientRect();
    const baseCenter = {
        x: baseRect.left + baseRect.width / 2,
        y: baseRect.top + baseRect.height / 2
    };
    const maxDistance = baseRect.width / 2 - 25;
    
    let isDragging = false;
    
    function handleTouchStart(e) {
        e.preventDefault();
        isDragging = true;
        joystickActive = true;
        document.body.style.overflow = 'hidden';
    }
    
    function handleTouchMove(e) {
        if (!isDragging) return;
        e.preventDefault();
        
        const touch = e.touches[0];
        const dx = touch.clientX - baseCenter.x;
        const dy = touch.clientY - baseCenter.y;
        const distance = Math.sqrt(dx * dx + dy * dy);
        
        if (distance > maxDistance) {
            const angle = Math.atan2(dy, dx);
            joystickData.x = Math.cos(angle);
            joystickData.y = Math.sin(angle);
            
            const limitedX = Math.cos(angle) * maxDistance;
            const limitedY = Math.sin(angle) * maxDistance;
            joystickThumb.style.transform = `translate(calc(-50% + ${limitedX}px), calc(-50% + ${limitedY}px))`;
        } else {
            joystickData.x = dx / maxDistance;
            joystickData.y = dy / maxDistance;
            
            joystickThumb.style.transform = `translate(calc(-50% + ${dx}px), calc(-50% + ${dy}px))`;
        }
    }
    
    function handleTouchEnd() {
        isDragging = false;
        joystickActive = false;
        joystickData.x = 0;
        joystickData.y = 0;
        joystickThumb.style.transform = 'translate(-50%, -50%)';
        document.body.style.overflow = 'auto';
    }
    
    joystickContainer.addEventListener('touchstart', handleTouchStart, { passive: false });
    joystickContainer.addEventListener('touchmove', handleTouchMove, { passive: false });
    joystickContainer.addEventListener('touchend', handleTouchEnd);
    joystickContainer.addEventListener('touchcancel', handleTouchEnd);
}

// ========================================
// ADD EVENT LISTENERS - FIXED FOR MOBILE
// ========================================
function addEventListeners() {
    // Desktop nav buttons
    document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            const section = e.currentTarget.dataset.section;
            moveToSection(section);
        });
    });
    
    // Mobile nav toggle
    const mobileNavToggle = document.getElementById('mobileNavToggle');
    const mobileNavMenu = document.getElementById('mobileNavMenu');
    
    if (mobileNavToggle && mobileNavMenu) {
        mobileNavToggle.addEventListener('click', () => {
            mobileNavMenu.classList.toggle('active');
        });
        
        // Mobile nav items
        document.querySelectorAll('.mobile-nav-item').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const section = e.currentTarget.dataset.section;
                moveToSection(section);
                mobileNavMenu.classList.remove('active');
            });
        });
    }
    
    // Action button (Mobile) - FIXED
    const mobileActionButton = document.getElementById('mobileActionButton');
    if (mobileActionButton) {
        mobileActionButton.addEventListener('click', (e) => {
            e.stopPropagation();
            e.preventDefault();
            console.log('Mobile action button clicked!');
            openContentPanel();
        });
        
        // Also add touch event for better mobile support
        mobileActionButton.addEventListener('touchstart', (e) => {
            e.stopPropagation();
            e.preventDefault();
            console.log('Mobile action button touched!');
            openContentPanel();
        });
    }
    
    // Read button (Desktop)
    const desktopReadButton = document.getElementById('desktopReadButton');
    if (desktopReadButton) {
        desktopReadButton.addEventListener('click', openContentPanel);
    }
    
    // Close panel
    const closePanel = document.getElementById('closePanel');
    if (closePanel) {
        closePanel.addEventListener('click', closeContentPanel);
    }
    
    // Start button (Mobile)
    const startButton = document.getElementById('startButton');
    if (startButton) {
        startButton.addEventListener('click', (e) => {
            e.stopPropagation();
            startButton.style.display = 'none';
            alert('ðŸŽ® O\'rmonni o\'rganishni boshladik!\n\nâ€¢ Joystick bilan harakatlaning\nâ€¢ Pastdagi yashil tugma - O\'qish\nâ€¢ Pastdagi kompas - Bo\'limlar');
        });
    }
    
    // Keyboard (Desktop)
    if (!isMobile) {
        document.addEventListener('keydown', (e) => {
            if (isPanelOpen) return;
            
            switch(e.key.toLowerCase()) {
                case 'escape':
                    if (controls.isLocked) {
                        controls.unlock();
                    }
                    break;
                case 'e':
                    openContentPanel();
                    break;
                case 'w':
                    moveForward = true;
                    break;
                case 's':
                    moveBackward = true;
                    break;
                case 'a':
                    moveLeft = true;
                    break;
                case 'd':
                    moveRight = true;
                    break;
            }
        });
        
        document.addEventListener('keyup', (e) => {
            switch(e.key.toLowerCase()) {
                case 'w':
                    moveForward = false;
                    break;
                case 's':
                    moveBackward = false;
                    break;
                case 'a':
                    moveLeft = false;
                    break;
                case 'd':
                    moveRight = false;
                    break;
            }
        });
    }
    
    // Window resize
    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });
    
    // Setup joystick on mobile
    if (isMobile) {
        setupJoystick();
    }
}

// ========================================
// ANIMATE - ENHANCED
// ========================================
let prevTime = performance.now();
const velocity = new THREE.Vector3();
const direction = new THREE.Vector3();

function animate() {
    requestAnimationFrame(animate);
    
    const time = performance.now();
    const delta = (time - prevTime) * 0.001;
    
    // Animate grass with wind (more realistic)
    grass.forEach((blade, index) => {
        const windStrength = 0.15;
        const windSpeed = 0.003;
        blade.rotation.z = Math.sin(time * windSpeed + index * 0.1) * windStrength;
        blade.rotation.x = Math.sin(time * windSpeed * 0.7 + index * 0.05) * windStrength * 0.5;
    });
    
    // Animate flowers with wind
    flowers.forEach((flower, index) => {
        const windStrength = 0.1;
        const windSpeed = 0.002;
        flower.stem.rotation.x = Math.sin(time * windSpeed + index * 0.1) * windStrength;
        flower.head.position.y = 0.85 + Math.sin(time * windSpeed * 1.5 + index * 0.2) * windStrength * 0.3;
    });
    
    // Animate birds with wing flapping
    birds.forEach(bird => {
        bird.angle += bird.speed;
        const x = bird.center.x + Math.cos(bird.angle) * bird.radius;
        const z = bird.center.z + Math.sin(bird.angle) * bird.radius;
        const y = bird.height + Math.sin(bird.angle * 2) * 3;
        
        bird.mesh.position.set(x, y, z);
        bird.mesh.rotation.y = Math.PI + Math.cos(bird.angle * 0.5);
        
        // Wing flapping animation
        bird.wingAngle += 0.2;
        const wingFlap = Math.sin(bird.wingAngle) * 0.5;
        bird.leftWing.rotation.z = -Math.PI / 4 + wingFlap;
        bird.rightWing.rotation.z = Math.PI / 4 - wingFlap;
    });
    
    // Animate clouds
    clouds.forEach(cloud => {
        cloud.mesh.position.x += Math.cos(cloud.direction) * cloud.speed;
        cloud.mesh.position.z += Math.sin(cloud.direction) * cloud.speed;
        
        // Wrap clouds around
        if (cloud.mesh.position.x > 300) cloud.mesh.position.x = -300;
        if (cloud.mesh.position.x < -300) cloud.mesh.position.x = 300;
        if (cloud.mesh.position.z > 300) cloud.mesh.position.z = -300;
        if (cloud.mesh.position.z < -300) cloud.mesh.position.z = 300;
    });
    
    // Player movement - TEZROQ
    if ((controls.isLocked && !isMobile) || (isMobile && joystickActive)) {
        velocity.x -= velocity.x * 10.0 * delta;
        velocity.z -= velocity.z * 10.0 * delta;
        
        if (!isMobile) {
            // Desktop controls
            direction.z = Number(moveForward) - Number(moveBackward);
            direction.x = Number(moveRight) - Number(moveLeft);
        } else {
            // Mobile joystick controls
            direction.z = -joystickData.y;
            direction.x = joystickData.x;
        }
        
        direction.normalize();
        
        if (Math.abs(direction.z) > 0.1 || Math.abs(direction.x) > 0.1) {
            velocity.z -= direction.z * MOVE_SPEED * delta;  // TEZROQ
            velocity.x -= direction.x * MOVE_SPEED * delta;  // TEZROQ
            
            controls.moveRight(-velocity.x * delta);
            controls.moveForward(-velocity.z * delta);
        }
    }
    
    prevTime = time;
    
    renderer.render(scene, camera);
}

// ========================================
// PRELOADER
// ========================================
window.addEventListener('load', () => {
    const preloader = document.querySelector('.preloader');
    const progress = document.querySelector('.loading-progress');
    
    let p = 0;
    const interval = setInterval(() => {
        p += 2;
        progress.style.width = `${p}%`;
        
        if (p >= 100) {
            clearInterval(interval);
            setTimeout(() => {
                preloader.classList.add('hidden');
                init();
            }, 500);
        }
    }, 40);
});

console.log('ðŸŒ² Yosh Ekologlar - 3D O\'rmon Sayohati');
console.log('ðŸ“± Mobil: Joystick + Tugma | ðŸ’» Desktop: Sichqoncha + WASD + E');
console.log('âœ¨ Realistik osmon, bulutlar, yulduzlar va tezroq harakat!');
    </script>
</body>
</html>
